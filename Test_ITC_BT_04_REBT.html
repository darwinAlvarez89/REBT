<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Examen Test REBT</title>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-RSH4ZW3VT2"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-RSH4ZW3VT2');
  </script>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    @media (prefers-reduced-motion: reduce) {
      * { animation-duration: .01ms !important; animation-iteration-count: 1 !important; transition-duration: .01ms !important; }
    }
  </style>

  <script>
    /* ===== Banco de preguntas (20) – Articulado REBT ===== */
    const preguntas = [
  {
    pregunta: "Según el REBT, la puesta en servicio de una instalación eléctrica se efectuará una vez que:",
    opciones: ["Se realicen las verificaciones y se disponga del certificado de instalación", "La empresa suministradora autorice el suministro", "El titular firme un contrato con el instalador", "El organismo de control realice una inspección periódica"],
    respuesta: "Se realicen las verificaciones y se disponga del certificado de instalación"
  },
  {
    pregunta: "Según el REBT, el certificado de instalación será emitido por:",
    opciones: ["El organismo de control autorizado", "El titular de la instalación", "La empresa instaladora que ejecutó la instalación", "La compañía suministradora"],
    respuesta: "La empresa instaladora que ejecutó la instalación"
  },
  {
    pregunta: "Según el REBT, cuando una instalación requiera proyecto, el certificado de instalación deberá ir acompañado de:",
    opciones: ["El acta de inspección periódica", "El proyecto y el certificado final de obra", "La declaración de conformidad del titular", "La memoria técnica de diseño"],
    respuesta: "El proyecto y el certificado final de obra"
  },
  {
    pregunta: "Según el REBT, las instalaciones que no precisan proyecto deberán ir acompañadas de:",
    opciones: ["Una memoria técnica de diseño", "Una inspección inicial de un organismo de control", "El certificado de dirección facultativa", "Un acta de puesta en marcha"],
    respuesta: "Una memoria técnica de diseño"
  },
  {
    pregunta: "Según el REBT, el certificado de instalación deberá presentarse ante:",
    opciones: ["La empresa distribuidora y el órgano competente de la Comunidad Autónoma", "El Ayuntamiento correspondiente", "El Ministerio de Industria directamente", "La entidad local de energía"],
    respuesta: "La empresa distribuidora y el órgano competente de la Comunidad Autónoma"
  },
  {
    pregunta: "Según el REBT, los titulares de las instalaciones deberán conservar el certificado de instalación durante:",
    opciones: ["Toda la vida útil de la instalación", "Cinco años", "Diez años", "Hasta la primera inspección periódica"],
    respuesta: "Toda la vida útil de la instalación"
  },
  {
    pregunta: "Según el REBT, las instalaciones correspondientes a industria en general requerirán proyecto cuando la potencia instalada sea superior a:",
    opciones: ["10 kW", "15 kW", "20 kW", "25 kW"],
    respuesta: "20 kW"
  },
  {
    pregunta: "Según el REBT, las instalaciones en garajes o aparcamientos cubiertos requerirán proyecto cuando la potencia instalada sea superior a:",
    opciones: ["5 kW", "10 kW", "15 kW", "20 kW"],
    respuesta: "10 kW"
  },
  {
    pregunta: "Según el REBT, los titulares de las instalaciones están obligados a mantenerlas en buen estado para:",
    opciones: ["Garantizar la seguridad de las personas y los bienes", "Facilitar las inspecciones periódicas", "Cumplir con los requisitos del contrato eléctrico", "Evitar penalizaciones por la empresa distribuidora"],
    respuesta: "Garantizar la seguridad de las personas y los bienes"
  },
  {
    pregunta: "Según el REBT, el suministro de energía se podrá realizar una vez:",
    opciones: ["La empresa distribuidora reciba el certificado de instalación", "Se haya obtenido la licencia municipal", "El técnico competente emita el boletín de obra", "El órgano competente lo apruebe expresamente"],
    respuesta: "La empresa distribuidora reciba el certificado de instalación"
  },
  {
    pregunta: "Según el REBT, la empresa suministradora podrá realizar verificaciones a su cargo para comprobar:",
    opciones: ["El cumplimiento de las prescripciones del Reglamento", "El contrato de mantenimiento de la instalación", "El consumo de energía mensual", "La calibración de los contadores eléctricos"],
    respuesta: "El cumplimiento de las prescripciones del Reglamento"
  },
  {
    pregunta: "Según el REBT, si las verificaciones realizadas por la empresa suministradora detectan valores fuera de los límites de aislamiento o corrientes de fuga:",
    opciones: ["Podrá conectar la instalación provisionalmente", "Deberá comunicarlo al instalador sin interrumpir el servicio", "No podrá conectar la instalación a su red", "Podrá autorizarla bajo inspección adicional"],
    respuesta: "No podrá conectar la instalación a su red"
  },
  {
    pregunta: "Según el REBT, el certificado de instalación emitido por un organismo de control autorizado deberá extenderse en:",
    opciones: ["Tres copias", "Cuatro copias", "Cinco copias", "Seis copias"],
    respuesta: "Cinco copias"
  },
  {
    pregunta: "Según el REBT, cuando la tramitación del certificado de instalación se realice por medios electrónicos, se emitirá:",
    opciones: ["Una sola copia", "Dos copias", "Tres copias", "Cinco copias"],
    respuesta: "Una sola copia"
  },
  {
    pregunta: "Según el REBT, en caso de incumplimiento en la verificación de la empresa suministradora, se deberá emitir:",
    opciones: ["Un acta firmada por el titular y remitida al órgano competente", "Un informe técnico sin necesidad de firma", "Un certificado de deficiencias", "Una comunicación a la empresa instaladora"],
    respuesta: "Un acta firmada por el titular y remitida al órgano competente"
  },
  {
    pregunta: "Según el REBT, la empresa instaladora será responsable de:",
    opciones: ["Emitir el certificado de instalación y conservar copia", "Verificar periódicamente el consumo eléctrico", "Supervisar el funcionamiento de los contadores", "Realizar las inspecciones periódicas cada 5 años"],
    respuesta: "Emitir el certificado de instalación y conservar copia"
  },
  {
    pregunta: "Según el REBT, la documentación técnica de una instalación incluirá:",
    opciones: ["Proyecto o memoria técnica, certificado de instalación y actas correspondientes", "Solo el proyecto aprobado", "Acta de entrega de materiales", "Un contrato con la distribuidora eléctrica"],
    respuesta: "Proyecto o memoria técnica, certificado de instalación y actas correspondientes"
  },
  {
    pregunta: "Según el REBT, los certificados de instalación se extenderán en los modelos establecidos por:",
    opciones: ["El órgano competente de la Comunidad Autónoma", "El Ministerio de Industria y Energía", "La empresa suministradora", "El Colegio Oficial de Ingenieros Técnicos"],
    respuesta: "El órgano competente de la Comunidad Autónoma"
  },
  {
    pregunta: "Según el REBT, las instalaciones en locales de pública concurrencia deberán:",
    opciones: ["Contar siempre con proyecto técnico, cualquiera que sea su potencia", "Presentar solo memoria técnica si son menores de 10 kW", "Tener únicamente certificado de instalación", "Requerir proyecto solo si superan 25 kW"],
    respuesta: "Contar siempre con proyecto técnico, cualquiera que sea su potencia"
  },
 {
  pregunta: "Según el REBT, la documentación técnica de la instalación deberá conservarse y ponerse a disposición del órgano competente:",
  opciones: [
    "Solo cuando se realicen modificaciones importantes",
    "Cuando lo solicite el órgano competente o durante la vida útil de la instalación",
    "Únicamente durante los cinco primeros años",
    "Hasta la primera inspección periódica obligatoria"
  ],
  respuesta: "Cuando lo solicite el órgano competente o durante la vida útil de la instalación"
}

];




    /* ===== Estado ===== */
    let preguntasAleatorias = [];
    let indice = 0, aciertos = 0, errores = 0;
    let historial = [];
    let seleccionUsuario = null;
    let respondido = false;

    // Tiempo
    const DURACION_SEG = 60 * 60; // <<< 60 minutos
    let inicioTiempo = null;
    let intervaloTiempo = null;
    let tiempoAgotado = false;

    /* ===== Utilidades ===== */
    const mezclar = (arr) => { for (let i = arr.length-1; i>0; i--) { const j = Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]]; } return arr; };

    function mezclarPreguntas(){
      preguntasAleatorias = mezclar(preguntas.map(p=>({...p, opciones: mezclar([...p.opciones]) })));
      indice=0; aciertos=0; errores=0; historial=[];
    }

    const fmt2 = (n) => String(n).padStart(2,'0');
    const clamp0 = (x) => x < 0 ? 0 : x;

    function calcularPuntuacion(){
      const total = preguntasAleatorias.length;              // 20
      const penalizacion = Math.floor(errores / 2);          // cada 2 fallos = 1 válida menos
      const validasNetas = Math.max(0, aciertos - penalizacion);
      const puntos = validasNetas * 0.5;                     // cada válida = 0,5 puntos
      const porcentaje = clamp0((validasNetas / total) * 100); // % sobre preguntas válidas netas / total
      const apto = porcentaje >= 80;                         // mínimo 80%
      return { total, respondidas: aciertos+errores, enBlanco: total-(aciertos+errores), penalizacion, validasNetas, puntos, porcentaje, apto };
    }

    /* ===== Render ===== */
    function setProgreso(){
      const total = preguntasAleatorias.length;
      const pct = Math.round((indice/total)*100);
      const bar = document.getElementById('progress-bar');
      bar.style.width = pct + '%';
      bar.setAttribute('aria-valuenow', pct);
      document.getElementById('progress-txt').textContent = `${indice}/${total}`;
    }

    function actualizarContador(){
      if (!inicioTiempo) return;
      const transcurrido = Math.floor((Date.now()-inicioTiempo)/1000);
      const restantes = Math.max(0, DURACION_SEG - transcurrido);
      const mm = fmt2(Math.floor(restantes/60));
      const ss = fmt2(restantes%60);

      const { puntos } = calcularPuntuacion();
      const totalPuntos = preguntasAleatorias.length * 0.5;

      const relojClass =
        restantes <= 60 ? 'text-red-700' :
        restantes <= 5*60 ? 'text-orange-600' :
        'text-blue-700';

      document.getElementById("contador").innerHTML = `
        <span>Cuestión: ${indice + 1}/${preguntasAleatorias.length}</span>
        <span class="text-green-600">Aciertos: ${aciertos}</span>
        <span class="text-red-600">Fallos: ${errores}</span>
        <span>Puntos: ${puntos.toFixed(2)} / ${totalPuntos.toFixed(2)}</span>
        <span class="font-mono ${relojClass}">⏳ ${mm}:${ss}</span>`;

      if (restantes === 0 && !tiempoAgotado){
        tiempoAgotado = true;
        clearInterval(intervaloTiempo);
        deshabilitarInteraccion();
        abrirModalFin();
      }
    }

    function renderOpciones(opciones){
      const cont = document.getElementById("opciones");
      cont.innerHTML = "";
      opciones.forEach((op, i)=>{
        const btn = document.createElement("button");
        btn.type="button";
        btn.dataset.valor = op;
        btn.className="opcion w-full text-left bg-blue-600 hover:bg-blue-700 text-white px-5 py-3 rounded-xl shadow transition focus-visible:outline-none focus-visible:ring-4 focus-visible:ring-blue-300";
        btn.innerHTML = `<span class="font-semibold tracking-wide">${op}</span>`;
        btn.onclick = ()=>seleccionarOpcion(op);
        btn.setAttribute('aria-label',`Opción ${i+1}: ${op}`);
        cont.appendChild(btn);
      });
    }

    function cargarPregunta(){
      if (indice>=preguntasAleatorias.length) return mostrarResumen();
      const q = preguntasAleatorias[indice];
      seleccionUsuario=null; respondido=false;
      document.getElementById("pregunta").textContent = q.pregunta;
      renderOpciones(q.opciones);
      document.getElementById("acciones").innerHTML =
        `<div class="flex items-center justify-between mt-4 text-sm text-slate-500">
           <span>Elige una respuesta (teclas 1–4 y Enter).</span>
           <button disabled id="btn-contestar" class="opacity-50 cursor-not-allowed bg-slate-800 text-white px-4 py-2 rounded-lg">Contestar</button>
         </div>`;
      setProgreso(); actualizarContador();
    }

    function seleccionarOpcion(opcion){
      if (respondido || tiempoAgotado) return;
      seleccionUsuario = opcion;
      document.querySelectorAll("#opciones .opcion").forEach(b=>{
        b.classList.remove('ring','ring-yellow-300','translate-y-0.5');
        if (b.dataset.valor===opcion) b.classList.add('ring','ring-yellow-300','translate-y-0.5');
      });
      const btn = document.getElementById('btn-contestar');
      btn.disabled=false; btn.classList.remove('opacity-50','cursor-not-allowed'); btn.onclick=verificarRespuesta;
    }

    function verificarRespuesta(){
      if (respondido || !seleccionUsuario || tiempoAgotado) return;
      const actual = preguntasAleatorias[indice];
      const ok = seleccionUsuario===actual.respuesta;
      respondido = true;

      document.querySelectorAll("#opciones .opcion").forEach(b=>{
        b.disabled=true; b.classList.remove('ring','ring-yellow-300');
        const val=b.dataset.valor;
        if (val===actual.respuesta){ b.classList.add('bg-green-600','hover:bg-green-700'); b.innerHTML=`✅ <span class="font-semibold">${val}</span>`; }
        else if (val===seleccionUsuario && !ok){ b.classList.add('bg-red-600','hover:bg-red-700'); b.innerHTML=`❌ <span class="font-semibold">${val}</span>`; }
        else { b.classList.add('bg-blue-500'); }
      });

      ok ? aciertos++ : errores++;
      historial.push({pregunta:actual.pregunta, opciones:actual.opciones, correcta:actual.respuesta, elegida:seleccionUsuario});

      document.getElementById("acciones").innerHTML =
        `<div class="mt-4 flex items-center justify-end gap-3">
           <button onclick="siguientePregunta()" class="bg-blue-600 hover:bg-blue-700 text-white px-5 py-2 rounded-lg shadow">Siguiente</button>
         </div>`;
      actualizarContador(); setProgreso();
    }

    const siguientePregunta = ()=>{ if (!tiempoAgotado){ indice++; cargarPregunta(); } };

    function deshabilitarInteraccion(){
      document.querySelectorAll("#opciones .opcion").forEach(b=>{ b.disabled=true; });
      document.getElementById('btn-contestar')?.setAttribute('disabled','true');
      document.removeEventListener('keydown', handleKey);
    }

    function abrirModalFin(){
      const { total, respondidas, enBlanco, penalizacion, validasNetas, puntos, porcentaje, apto } = calcularPuntuacion();
      const modal = document.getElementById('modal-fin');
      const totalPuntos = total * 0.5;
      document.getElementById('modal-resumen').innerHTML = `
        <p class="text-slate-700">Respondidas: <strong>${respondidas}</strong> • En blanco: <strong>${enBlanco}</strong> • Total: ${total}</p>
        <p class="text-slate-700">Aciertos: <strong class="text-green-700">${aciertos}</strong> • Fallos: <strong class="text-red-700">${errores}</strong></p>
        <p class="text-slate-700">Penalización aplicada: <strong>-${penalizacion}</strong> válidas (=${(penalizacion*0.5).toFixed(2)} pts)</p>
        <p class="text-slate-700">Válidas netas: <strong>${validasNetas}</strong> / ${total}</p>
        <p class="text-slate-700">Puntuación: <strong>${puntos.toFixed(2)} / ${totalPuntos.toFixed(2)}</strong> (<strong>${porcentaje.toFixed(2)}%</strong>)</p>
        <p class="${apto?'text-emerald-700':'text-red-700'} font-bold text-lg mt-1">${apto?'APTO ✅':'NO APTO ❌'}</p>
      `;
      modal.classList.remove('hidden');
      modal.classList.add('flex');
    }

    function mostrarResumen(){
      clearInterval(intervaloTiempo);
      const total = preguntasAleatorias.length;
      const transcurrido = Math.floor((Date.now()-inicioTiempo)/1000);
      const mm = fmt2(Math.floor(transcurrido/60));
      const ss = fmt2(transcurrido%60);

      const { penalizacion, validasNetas, puntos, porcentaje, apto } = calcularPuntuacion();

      const detalle = historial.map(h=>`
        <div class='mb-2 border border-slate-200 rounded-lg p-3'>
          <p class='font-semibold mb-2'>${h.pregunta}</p>
          <div class='flex flex-wrap gap-2'>
            ${h.opciones.map(op=>{
              if (op===h.elegida && op===h.correcta) return `<span class='bg-green-100 text-green-900 px-2.5 py-1 rounded-md'>✅ ${op}</span>`;
              if (op===h.elegida && op!==h.correcta) return `<span class='bg-red-100 text-red-900 px-2.5 py-1 rounded-md'>❌ ${op}</span>`;
              if (op===h.correcta && op!==h.elegida) return `<span class='bg-emerald-50 text-emerald-800 px-2.5 py-1 rounded-md'>✔ ${op}</span>`;
              return `<span class='px-2.5 py-1 rounded-md bg-slate-50'>${op}</span>`;
            }).join('')}
          </div>
        </div>`).join('');

      const totalPuntos = total * 0.5;

      document.getElementById("test").innerHTML = `
        <div class="space-y-3">
          <h2 class="text-2xl font-extrabold">Resultado del test <span class="${apto?'text-emerald-700':'text-red-700'} text-xl align-middle">(${apto?'APTO ✅':'NO APTO ❌'})</span></h2>
          <p class="text-slate-700">Aciertos: <strong class="text-green-700">${aciertos}</strong> • Fallos: <strong class="text-red-700">${errores}</strong> • Penalización: <strong>-${penalizacion}</strong> válidas</p>
          <p class="text-slate-700">Válidas netas: <strong>${validasNetas}</strong> / ${total} • Puntuación: <strong>${puntos.toFixed(2)} / ${totalPuntos.toFixed(2)}</strong> (<strong>${porcentaje.toFixed(2)}%</strong>)</p>
          <p class="text-slate-700">Tiempo empleado: <span class="font-mono">${mm}:${ss}</span></p>
          <hr class="my-3 border-slate-200">
          <h3 class="text-lg font-bold">Detalle de preguntas</h3>
          <div class="max-h-[50vh] overflow-auto pr-1">${detalle}</div>
        </div>

        <div class="flex flex-wrap items-center justify-center gap-3 mt-6">
          <button onclick="window.location.reload()" class="bg-emerald-600 hover:bg-emerald-700 text-white px-5 py-2 rounded-lg shadow">Volver a intentar</button>
          <a href="index.html" class="bg-slate-700 hover:bg-slate-800 text-white px-5 py-2 rounded-lg shadow">Volver al inicio</a>
        </div>`;
    }

    /* ===== Atajos de teclado ===== */
    function handleKey(e){
      if (tiempoAgotado) return;
      if (respondido){ if (e.key==='Enter') siguientePregunta(); return; }
      const map={'1':0,'2':1,'3':2,'4':3};
      if (map[e.key]!==undefined){ const b=document.querySelectorAll('#opciones .opcion')[map[e.key]]; if (b) b.click(); }
      if (e.key==='Enter'){ const b=document.getElementById('btn-contestar'); if (b && !b.disabled) b.click(); }
    }

    window.onload = ()=>{
      mezclarPreguntas();
      inicioTiempo = Date.now();
      cargarPregunta();
      intervaloTiempo = setInterval(actualizarContador, 1000);
      document.addEventListener('keydown', handleKey);
    };
  </script>
</head>

<body class="bg-gray-100 text-gray-900 p-4">
  <div class="max-w-3xl mx-auto bg-white p-6 md:p-8 rounded-2xl shadow-lg ring-1 ring-slate-100" id="test">
    <div class="mb-4">
      <div class="flex items-center justify-between text-sm text-slate-600 mb-2">
        <p id="contador" class="font-semibold space-x-4"></p>
        <span id="progress-txt" class="font-mono text-slate-500">0/0</span>
      </div>
      <div class="w-full bg-slate-200 rounded-full h-2.5 overflow-hidden">
        <div id="progress-bar" class="bg-blue-600 h-2.5 rounded-full transition-all duration-300 ease-out" style="width:0%" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"></div>
      </div>
    </div>

    <h1 class="text-3xl font-extrabold mb-3 text-center">Test ITC-BT-04</h1>
    <p id="pregunta" class="mb-4 text-lg text-center"></p>

    <div id="opciones" class="flex flex-col gap-3"></div>
    <div id="acciones" class="mt-2"></div>
  </div>

  <div class="mt-6 text-center">
    <a href="Test_por_ITC_del_REBT.html" class="inline-block bg-gray-700 hover:bg-gray-900 text-white px-6 py-2 rounded-lg shadow">Cancelar</a>
  </div>

  <!-- Modal Tiempo Agotado -->
  <div id="modal-fin" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/50 p-4">
    <div class="bg-white rounded-2xl shadow-xl max-w-lg w-full p-6">
      <h2 class="text-2xl font-extrabold mb-1">⏰ Tiempo agotado</h2>
      <p class="text-slate-600 mb-4">Tu tiempo se ha agotado. Estos son tus resultados:</p>
      <div id="modal-resumen" class="space-y-1 text-slate-800"></div>
      <div class="mt-6 flex justify-end">
        <button onclick="window.location.reload()" class="bg-emerald-600 hover:bg-emerald-700 text-white px-5 py-2 rounded-lg shadow">Volver a intentar</button>
      </div>
    </div>
  </div>
</body>
</html>
