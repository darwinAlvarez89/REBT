<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Test 2 – ITC por Contenido | Electrificación Básica</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @media (prefers-reduced-motion: reduce) {
      * { animation-duration: .01ms !important; animation-iteration-count: 1 !important; transition-duration: .01ms !important; }
    }
  </style>

  <script>
    /* ===== Banco ===== */
    const preguntas = [
      {"pregunta":"¿Qué regula la ITC-BT-03?","opciones":["Empresas instaladoras en baja tensión","Documentación y puesta en servicio de instalaciones eléctricas","Verificaciones e inspecciones","Instalaciones en viviendas"],"respuesta":"Empresas instaladoras en baja tensión"},
      {"pregunta":"¿Qué regula la ITC-BT-04?","opciones":["Documentación y puesta en servicio de instalaciones eléctricas","Empresas instaladoras en baja tensión","Instalaciones en viviendas","Verificaciones e inspecciones"],"respuesta":"Documentación y puesta en servicio de instalaciones eléctricas"},
      {"pregunta":"¿Qué regula la ITC-BT-05?","opciones":["Verificaciones e inspecciones","Empresas instaladoras en baja tensión","Protección contra sobreintensidades","Locales de pública concurrencia"],"respuesta":"Verificaciones e inspecciones"},
      {"pregunta":"¿Qué regula la ITC-BT-08?","opciones":["Sistemas de conexión del neutro y las masas en redes de distribución","Instalaciones de puesta a tierra","Prescripciones generales de interiores","Instalaciones generadoras de baja tensión"],"respuesta":"Sistemas de conexión del neutro y las masas en redes de distribución"},
      {"pregunta":"¿Qué regula la ITC-BT-09?","opciones":["Alumbrado exterior","Instalaciones de puesta a tierra","Previsión de cargas","Saunas"],"respuesta":"Alumbrado exterior"},
      {"pregunta":"¿Qué regula la ITC-BT-10?","opciones":["Previsión de cargas para suministros en baja tensión","Empresas instaladoras en baja tensión","Instalaciones en locales especiales","Receptores de alumbrado"],"respuesta":"Previsión de cargas para suministros en baja tensión"},
      {"pregunta":"¿Qué regula la ITC-BT-12?","opciones":["Esquemas de las instalaciones de enlace","Contadores","Locales con bañera o ducha","Instalaciones interiores"],"respuesta":"Esquemas de las instalaciones de enlace"},
      {"pregunta":"¿Qué regula la ITC-BT-13?","opciones":["Cajas generales de protección en las instalaciones de enlace","Esquemas de enlace","Locales de pública concurrencia","Transformadores"],"respuesta":"Cajas generales de protección en las instalaciones de enlace"},
      {"pregunta":"¿Qué regula la ITC-BT-14?","opciones":["Línea general de alimentación","Instalaciones interiores","Instalaciones provisionales de obra","Instalaciones de baja tensión en muebles"],"respuesta":"Línea general de alimentación"},
      {"pregunta":"¿Qué regula la ITC-BT-15?","opciones":["Derivaciones individuales","Número de circuitos en viviendas","Protección contra sobretensiones","Piscinas y fuentes"],"respuesta":"Derivaciones individuales"},
      {"pregunta":"¿Qué regula la ITC-BT-16?","opciones":["Ubicación y sistemas de instalación de contadores","Línea general de alimentación","Cables radiantes","Infraestructura de recarga de vehículos eléctricos"],"respuesta":"Ubicación y sistemas de instalación de contadores"},
      {"pregunta":"¿Qué regula la ITC-BT-17?","opciones":["ICP y otros dispositivos de mando y protección","Transformadores","Cajas generales de protección","Instalaciones provisionales de obra"],"respuesta":"ICP y otros dispositivos de mando y protección"},
      {"pregunta":"¿Qué regula la ITC-BT-18?","opciones":["Instalaciones de puesta a tierra","Sistemas de conexión del neutro","Muy baja tensión","Locales con sauna"],"respuesta":"Instalaciones de puesta a tierra"},
      {"pregunta":"¿Qué regula la ITC-BT-19?","opciones":["Prescripciones generales de las instalaciones interiores o receptoras","Instalaciones en viviendas","Protección contra contactos directos e indirectos","Puertos y marinas"],"respuesta":"Prescripciones generales de las instalaciones interiores o receptoras"},
      {"pregunta":"¿Qué regula la ITC-BT-20?","opciones":["Sistemas de instalación en interiores","Tubos y canales protectores","Piscinas y fuentes","Derivaciones individuales"],"respuesta":"Sistemas de instalación en interiores"},
      {"pregunta":"¿Qué regula la ITC-BT-21?","opciones":["Tubos y canales protectores en interiores","Instalaciones de puesta a tierra","Locales de pública concurrencia","Protección contra sobreintensidades"],"respuesta":"Tubos y canales protectores en interiores"},
      {"pregunta":"¿Qué regula la ITC-BT-22?","opciones":["Protección contra sobreintensidades","Protección contra sobretensiones","Locales de pública concurrencia","Instalaciones generadoras"],"respuesta":"Protección contra sobreintensidades"},
      {"pregunta":"¿Qué regula la ITC-BT-23?","opciones":["Protección contra sobretensiones","Protección contra contactos","Alumbrado exterior","Instalaciones en caravanas"],"respuesta":"Protección contra sobretensiones"},
      {"pregunta":"¿Qué regula la ITC-BT-24?","opciones":["Protección contra contactos directos e indirectos","Locales de pública concurrencia","Número de circuitos","Previsión de cargas"],"respuesta":"Protección contra contactos directos e indirectos"},
      {"pregunta":"¿Qué regula la ITC-BT-25?","opciones":["Número de circuitos y características en viviendas","Derivaciones individuales","Instalaciones interiores","Piscinas y fuentes"],"respuesta":"Número de circuitos y características en viviendas"},
      {"pregunta":"¿Qué regula la ITC-BT-26?","opciones":["Prescripciones generales en viviendas","Infraestructura de recarga de vehículos eléctricos","Establecimientos agrícolas","Protección contra sobretensiones"],"respuesta":"Prescripciones generales en viviendas"},
      {"pregunta":"¿Qué regula la ITC-BT-27?","opciones":["Locales que contienen bañera o ducha","Ferias y stands","Piscinas y fuentes","Locales especiales"],"respuesta":"Locales que contienen bañera o ducha"},
      {"pregunta":"¿Qué regula la ITC-BT-28?","opciones":["Instalaciones en locales de pública concurrencia","Protección contra sobretensiones","Establecimientos agrícolas","Instalaciones provisionales de obra"],"respuesta":"Instalaciones en locales de pública concurrencia"},
      {"pregunta":"¿Qué regula la ITC-BT-30?","opciones":["Instalaciones en locales de características especiales","Piscinas y fuentes","Transformadores","Instalaciones provisionales"],"respuesta":"Instalaciones en locales de características especiales"},
      {"pregunta":"¿Qué regula la ITC-BT-31?","opciones":["Instalaciones en piscinas y fuentes","Locales de características especiales","Locales de pública concurrencia","Ferias y stands"],"respuesta":"Instalaciones en piscinas y fuentes"},
      {"pregunta":"¿Qué regula la ITC-BT-32?","opciones":["Máquinas de elevación y transporte","Locales agrícolas","Instalaciones interiores","Receptores"],"respuesta":"Máquinas de elevación y transporte"},
      {"pregunta":"¿Qué regula la ITC-BT-33?","opciones":["Instalaciones provisionales y temporales de obras","Locales agrícolas","Ferias y stands","Locales especiales"],"respuesta":"Instalaciones provisionales y temporales de obras"},
      {"pregunta":"¿Qué regula la ITC-BT-34?","opciones":["Ferias y stands","Locales agrícolas","Instalaciones en piscinas","Transformadores"],"respuesta":"Ferias y stands"},
      {"pregunta":"¿Qué regula la ITC-BT-35?","opciones":["Establecimientos agrícolas y hortícolas","Locales de pública concurrencia","Piscinas y fuentes","Receptores"],"respuesta":"Establecimientos agrícolas y hortícolas"},
      {"pregunta":"¿Qué regula la ITC-BT-36?","opciones":["Instalaciones a muy baja tensión","Instalaciones de puesta a tierra","Piscinas y fuentes","Locales especiales"],"respuesta":"Instalaciones a muy baja tensión"},
      {"pregunta":"¿Qué regula la ITC-BT-37?","opciones":["Instalaciones a tensiones especiales","Instalaciones a muy baja tensión","Generadores de baja tensión","Locales especiales"],"respuesta":"Instalaciones a tensiones especiales"},
      {"pregunta":"¿Qué regula la ITC-BT-39?","opciones":["Cercas eléctricas para ganado","Instalaciones generadoras de baja tensión","Protección contra contactos","Ferias y stands"],"respuesta":"Cercas eléctricas para ganado"},
      {"pregunta":"¿Qué regula la ITC-BT-40?","opciones":["Instalaciones generadoras de baja tensión","Protección contra sobretensiones","Sistemas de neutro","Locales de pública concurrencia"],"respuesta":"Instalaciones generadoras de baja tensión"},
      {"pregunta":"¿Qué regula la ITC-BT-41?","opciones":["Instalaciones eléctricas en caravanas","Receptores de alumbrado","Establecimientos agrícolas","Locales con sauna"],"respuesta":"Instalaciones eléctricas en caravanas"},
      {"pregunta":"¿Qué regula la ITC-BT-42?","opciones":["Instalaciones en puertos y marinas para barcos de recreo","Número de circuitos en viviendas","Establecimientos agrícolas","Receptores"],"respuesta":"Instalaciones en puertos y marinas para barcos de recreo"},
      {"pregunta":"¿Qué regula la ITC-BT-43?","opciones":["Instalación general de receptores","Receptores de alumbrado","Protección contra contactos","Locales de pública concurrencia"],"respuesta":"Instalación general de receptores"},
      {"pregunta":"¿Qué regula la ITC-BT-44?","opciones":["Receptores para alumbrado","Locales agrícolas","Ferias y stands","Protección contra sobretensiones"],"respuesta":"Receptores para alumbrado"},
      {"pregunta":"¿Qué regula la ITC-BT-45?","opciones":["Aparatos de caldeo","Transformadores","Cajas generales de protección","Locales agrícolas"],"respuesta":"Aparatos de caldeo"},
      {"pregunta":"¿Qué regula la ITC-BT-46?","opciones":["Cables y folios radiantes en viviendas","Receptores para alumbrado","Ferias y stands","Instalaciones interiores"],"respuesta":"Cables y folios radiantes en viviendas"},
      {"pregunta":"¿Qué regula la ITC-BT-47?","opciones":["Instalación de motores","Transformadores","Locales especiales","Caravanas"],"respuesta":"Instalación de motores"},
      {"pregunta":"¿Qué regula la ITC-BT-48?","opciones":["Transformadores, reactancias y condensadores","Aparatos de caldeo","Locales de pública concurrencia","Protección contra sobreintensidades"],"respuesta":"Transformadores, reactancias y condensadores"},
      {"pregunta":"¿Qué regula la ITC-BT-49?","opciones":["Instalaciones eléctricas en muebles","Protección contra sobretensiones","Locales agrícolas","Locales especiales"],"respuesta":"Instalaciones eléctricas en muebles"},
      {"pregunta":"¿Qué regula la ITC-BT-50?","opciones":["Instalaciones eléctricas en locales con radiadores para saunas","Alumbrado exterior","Locales especiales","Instalaciones interiores"],"respuesta":"Instalaciones eléctricas en locales con radiadores para saunas"},
      {"pregunta":"¿Qué regula la ITC-BT-52?","opciones":["Infraestructura para recarga de vehículos eléctricos","Prescripciones generales en viviendas","Cercas eléctricas","Instalaciones en puertos y marinas"],"respuesta":"Infraestructura para recarga de vehículos eléctricos"}
    ];

    /* ===== Estado ===== */
    let preguntasAleatorias=[]; let indice=0, aciertos=0, errores=0;
    let historial=[]; let seleccionUsuario=null; let respondido=false;
    let inicioTiempo=null; let intervaloTiempo=null;

    const mezclar=(a)=>{for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a;};
    function mezclarPreguntas(){ preguntasAleatorias = mezclar(preguntas.map(p=>({...p, opciones:mezclar([...p.opciones]) }))); indice=0; aciertos=0; errores=0; historial=[]; }

    function setProgreso(){ const t=preguntasAleatorias.length; const pct=Math.round((indice/t)*100); const b=document.getElementById('progress-bar'); b.style.width=pct+'%'; b.setAttribute('aria-valuenow',pct); document.getElementById('progress-txt').textContent=`${indice}/${t}`; }

    function actualizarContador(){ const s=inicioTiempo?Math.floor((Date.now()-inicioTiempo)/1000):0; const mm=String(Math.floor(s/60)).padStart(2,'0'); const ss=String(s%60).padStart(2,'0'); document.getElementById("contador").innerHTML=`<span>Cuestión: ${indice+1}/${preguntasAleatorias.length}</span><span class="text-green-600">Aciertos: ${aciertos}</span><span class="text-red-600">Fallos: ${errores}</span><span>Puntos: ${aciertos}</span><span class="font-mono ${s>=60?'text-orange-600':'text-indigo-700'}">⏱ ${mm}:${ss}</span>`; }

    function renderOpciones(ops){ const c=document.getElementById("opciones"); c.innerHTML=""; ops.forEach((op,i)=>{ const b=document.createElement("button"); b.type="button"; b.dataset.valor=op; b.className="opcion w-full text-left bg-indigo-600 hover:bg-indigo-700 text-white px-5 py-3 rounded-xl shadow transition focus-visible:outline-none focus-visible:ring-4 focus-visible:ring-indigo-300"; b.innerHTML=`<span class="font-semibold tracking-wide">${op}</span>`; b.onclick=()=>seleccionarOpcion(op); b.setAttribute('aria-label',`Opción ${i+1}: ${op}`); c.appendChild(b); }); }

    function cargarPregunta(){ if(indice>=preguntasAleatorias.length) return mostrarResumen(); const q=preguntasAleatorias[indice]; seleccionUsuario=null; respondido=false; document.getElementById("pregunta").textContent=q.pregunta; renderOpciones(q.opciones); document.getElementById("acciones").innerHTML=`<div class="flex items-center justify-between mt-4 text-sm text-slate-500"><span>Elige una respuesta (teclas 1–4 y Enter).</span><button disabled id="btn-contestar" class="opacity-50 cursor-not-allowed bg-slate-800 text-white px-4 py-2 rounded-lg">Contestar</button></div>`; setProgreso(); actualizarContador(); }

    function seleccionarOpcion(op){ if(respondido) return; seleccionUsuario=op; document.querySelectorAll("#opciones .opcion").forEach(b=>{ b.classList.remove('ring','ring-yellow-300','translate-y-0.5'); if(b.dataset.valor===op) b.classList.add('ring','ring-yellow-300','translate-y-0.5'); }); const bt=document.getElementById('btn-contestar'); bt.disabled=false; bt.classList.remove('opacity-50','cursor-not-allowed'); bt.onclick=verificarRespuesta; }

    function verificarRespuesta(){ if(respondido||!seleccionUsuario) return; const a=preguntasAleatorias[indice]; const ok=seleccionUsuario===a.respuesta; respondido=true; document.querySelectorAll("#opciones .opcion").forEach(b=>{ b.disabled=true; b.classList.remove('ring','ring-yellow-300'); const v=b.dataset.valor; if(v===a.respuesta){ b.classList.add('bg-green-600','hover:bg-green-700'); b.innerHTML=`✅ <span class="font-semibold">${v}</span>`; } else if(v===seleccionUsuario && !ok){ b.classList.add('bg-red-600','hover:bg-red-700'); b.innerHTML=`❌ <span class="font-semibold">${v}</span>`; } else { b.classList.add('bg-indigo-500'); } }); ok?aciertos++:errores++; historial.push({pregunta:a.pregunta, opciones:a.opciones, correcta:a.respuesta, elegida:seleccionUsuario}); document.getElementById("acciones").innerHTML=`<div class="mt-4 flex items-center justify-end gap-3"><button onclick="siguientePregunta()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-5 py-2 rounded-lg shadow">Siguiente</button></div>`; actualizarContador(); setProgreso(); }

    const siguientePregunta=()=>{ indice++; cargarPregunta(); };

    function mostrarResumen(){ clearInterval(intervaloTiempo); const t=preguntasAleatorias.length; const s=Math.floor((Date.now()-inicioTiempo)/1000); const mm=String(Math.floor(s/60)).padStart(2,'0'); const ss=String(s%60).padStart(2,'0'); const nota=Math.round((aciertos/t)*1000)/100; const det=historial.map(h=>`<div class='mb-2 border border-slate-200 rounded-lg p-3'><p class='font-semibold mb-2'>${h.pregunta}</p><div class='flex flex-wrap gap-2'>${h.opciones.map(op=>{ if(op===h.elegida && op===h.correcta) return `<span class='bg-green-100 text-green-900 px-2.5 py-1 rounded-md'>✅ ${op}</span>`; if(op===h.elegida && op!==h.correcta) return `<span class='bg-red-100 text-red-900 px-2.5 py-1 rounded-md'>❌ ${op}</span>`; if(op===h.correcta && op!==h.elegida) return `<span class='bg-emerald-50 text-emerald-800 px-2.5 py-1 rounded-md'>✔ ${op}</span>`; return `<span class='px-2.5 py-1 rounded-md bg-slate-50'>${op}</span>`; }).join('')}</div></div>`).join(''); document.getElementById("test").innerHTML=`<div class="space-y-3"><h2 class="text-2xl font-extrabold">Resultado del test</h2><p class="text-slate-700">Aciertos: <strong class="text-green-700">${aciertos}</strong> • Fallos: <strong class="text-red-700">${errores}</strong> • Total: ${t}</p><p class="text-slate-700">Tiempo total: <span class="font-mono">${mm}:${ss}</span> • Acierto: <strong>${nota}%</strong></p><hr class="my-3 border-slate-200"><h3 class="text-lg font-bold">Detalle de preguntas</h3><div class="max-h-[50vh] overflow-auto pr-1">${det}</div></div><div class="flex flex-wrap items-center justify-center gap-3 mt-6"><button onclick="window.location.reload()" class="bg-emerald-600 hover:bg-emerald-700 text-white px-5 py-2 rounded-lg shadow">Reiniciar</button><a href="index.html" class="bg-slate-700 hover:bg-slate-800 text-white px-5 py-2 rounded-lg shadow">Volver al inicio</a></div>`; }

    function handleKey(e){ if(respondido){ if(e.key==='Enter') siguientePregunta(); return; } const map={'1':0,'2':1,'3':2,'4':3}; if(map[e.key]!==undefined){ const b=document.querySelectorAll('#opciones .opcion')[map[e.key]]; if(b) b.click(); } if(e.key==='Enter'){ const b=document.getElementById('btn-contestar'); if(b && !b.disabled) b.click(); } }

    window.onload=()=>{ mezclarPreguntas(); inicioTiempo=Date.now(); cargarPregunta(); intervaloTiempo=setInterval(actualizarContador,1000); document.addEventListener('keydown',handleKey); };
  </script>
</head>

<body class="bg-gray-100 text-gray-900 p-4">
  <div class="max-w-3xl mx-auto bg-white p-6 md:p-8 rounded-2xl shadow-lg ring-1 ring-slate-100" id="test">
    <div class="mb-4">
      <div class="flex items-center justify-between text-sm text-slate-600 mb-2">
        <p id="contador" class="font-semibold space-x-4"></p>
        <span id="progress-txt" class="font-mono text-slate-500">0/0</span>
      </div>
      <div class="w-full bg-slate-200 rounded-full h-2.5 overflow-hidden">
        <div id="progress-bar" class="bg-indigo-600 h-2.5 rounded-full transition-all duration-300 ease-out" style="width:0%" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"></div>
      </div>
    </div>

    <h1 class="text-3xl font-extrabold mb-3 text-center">Test 2 – ITC por Contenido</h1>
    <p id="pregunta" class="mb-4 text-lg text-center"></p>

    <div id="opciones" class="flex flex-col gap-3"></div>
    <div id="acciones" class="mt-2"></div>
  </div>

  <div class="mt-6 text-center">
    <a href="index.html" class="inline-block bg-gray-700 hover:bg-gray-900 text-white px-6 py-2 rounded-lg shadow">Cancelar</a>
  </div>
</body>
</html>
