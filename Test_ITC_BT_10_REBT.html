<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Examen Test REBT</title>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-RSH4ZW3VT2"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-RSH4ZW3VT2');
  </script>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    @media (prefers-reduced-motion: reduce) {
      * { animation-duration: .01ms !important; animation-iteration-count: 1 !important; transition-duration: .01ms !important; }
    }
  </style>

  <script>
    /* ===== Banco de preguntas + explicaciones ===== */
    const 
    





preguntas = [
  {
    pregunta: "Seg√∫n el REBT, los lugares de consumo se clasifican, entre otros, en:",
    opciones: [
      "Edificios destinados principalmente a viviendas, edificios comerciales u oficinas, edificios destinados a una industria espec√≠fica, edificios destinados a una concentraci√≥n de industrias y aparcamientos con infraestructura de recarga de veh√≠culos el√©ctricos",
      "Viviendas unifamiliares y plurifamiliares exclusivamente",
      "Locales de p√∫blica concurrencia y centros docentes",
      "Pol√≠gonos industriales y parques tecnol√≥gicos √∫nicamente"
    ],
    respuesta: "Edificios destinados principalmente a viviendas, edificios comerciales u oficinas, edificios destinados a una industria espec√≠fica, edificios destinados a una concentraci√≥n de industrias y aparcamientos con infraestructura de recarga de veh√≠culos el√©ctricos",
    explicacion: "ITC-BT-10, punto 1: se establece la clasificaci√≥n de los lugares de consumo e incluye edificios destinados principalmente a viviendas, edificios comerciales o de oficinas, edificios destinados a una industria espec√≠fica, edificios destinados a una concentraci√≥n de industrias y aparcamientos dotados de infraestructura para la recarga de veh√≠culos el√©ctricos."
  },
  {
    pregunta: "Seg√∫n el REBT, la electrificaci√≥n b√°sica es la necesaria para:",
    opciones: [
      "Cubrir las necesidades primarias sin obras posteriores y permitir el uso de aparatos el√©ctricos de uso com√∫n",
      "Instalar sistemas de climatizaci√≥n el√©ctrica en toda vivienda",
      "Superficies √∫tiles de vivienda superiores a 160 m¬≤",
      "Viviendas con instalaci√≥n de recarga de veh√≠culo el√©ctrico"
    ],
    respuesta: "Cubrir las necesidades primarias sin obras posteriores y permitir el uso de aparatos el√©ctricos de uso com√∫n",
    explicacion: "ITC-BT-10, punto 2.1.1 Electrificaci√≥n b√°sica: se define como la necesaria para la cobertura de las posibles necesidades de utilizaci√≥n primarias sin necesidad de obras posteriores de adecuaci√≥n y que debe permitir la utilizaci√≥n de los aparatos el√©ctricos de uso com√∫n en una vivienda."
  },
  {
    pregunta: "Seg√∫n el REBT, tendr√°n electrificaci√≥n elevada las viviendas con:",
    opciones: [
      "Previsi√≥n de uso de m√°s electrodom√©sticos que la b√°sica o con calefacci√≥n/aire acondicionado, o superficie √∫til > 160 m¬≤, o con instalaci√≥n de recarga de veh√≠culo el√©ctrico en unifamiliares",
      "√önicamente superficies √∫tiles superiores a 120 m¬≤",
      "Instalaci√≥n de telecomunicaciones avanzada",
      "Iluminaci√≥n LED en todas las estancias"
    ],
    respuesta: "Previsi√≥n de uso de m√°s electrodom√©sticos que la b√°sica o con calefacci√≥n/aire acondicionado, o superficie √∫til > 160 m¬≤, o con instalaci√≥n de recarga de veh√≠culo el√©ctrico en unifamiliares",
    explicacion: "ITC-BT-10, punto 2.1.2 Electrificaci√≥n elevada: se refiere a viviendas con previsi√≥n de utilizaci√≥n de aparatos electrodom√©sticos superior a la b√°sica, o con sistemas de calefacci√≥n el√©ctrica o acondicionamiento de aire, o con superficies √∫tiles superiores a 160 m¬≤, o con una instalaci√≥n para la recarga del veh√≠culo el√©ctrico en viviendas unifamiliares, o cualquier combinaci√≥n de estos casos."
  },
  {
    pregunta: "Seg√∫n el REBT, en nuevas construcciones la potencia a prever por vivienda no ser√° inferior a:",
    opciones: ["5 750 W a 230 V", "4 600 W a 230 V", "6 000 W a 230 V", "7 360 W a 230 V"],
    respuesta: "5 750 W a 230 V",
    explicacion: "ITC-BT-10, punto 2.2 Previsi√≥n de la potencia: indica que, para nuevas construcciones, la potencia a prever en cada vivienda no ser√° inferior a 5 750 W a 230 V."
  },
  {
    pregunta: "Seg√∫n el REBT, en viviendas con electrificaci√≥n elevada, la potencia a prever no ser√° inferior a:",
    opciones: ["7 360 W", "9 200 W", "10 350 W", "14 490 W"],
    respuesta: "9 200 W",
    explicacion: "ITC-BT-10, punto 2.2: para las viviendas con grado de electrificaci√≥n elevada, la potencia a prever no ser√° inferior a 9 200 W."
  },
  {
    pregunta: "Seg√∫n el REBT, la potencia a prever en una vivienda se corresponde con:",
    opciones: [
      "La capacidad m√°xima definida por la intensidad asignada del IGA, seg√∫n ITC-BT-25",
      "La potencia inicialmente contratada por el usuario",
      "La suma de potencias de los receptores instalados",
      "El valor que indique la empresa instaladora"
    ],
    respuesta: "La capacidad m√°xima definida por la intensidad asignada del IGA, seg√∫n ITC-BT-25",
    explicacion: "ITC-BT-10, punto 2.2: en todos los casos, la potencia a prever se corresponder√° con la capacidad m√°xima de la instalaci√≥n, definida por la intensidad asignada del interruptor general autom√°tico, seg√∫n se indica en la ITC-BT-25."
  },
  {
    pregunta: "Seg√∫n el REBT, la carga correspondiente a un conjunto de viviendas se obtiene:",
    opciones: [
      "Multiplicando la media aritm√©tica de las potencias m√°ximas previstas por el coeficiente de simultaneidad de la tabla 1",
      "Sumando todas las potencias m√°ximas previstas sin reducci√≥n",
      "Tomando el m√°ximo entre todas las potencias individuales",
      "Aplicando un coeficiente fijo del 0,5 a la suma de potencias"
    ],
    respuesta: "Multiplicando la media aritm√©tica de las potencias m√°ximas previstas por el coeficiente de simultaneidad de la tabla 1",
    explicacion: "ITC-BT-10, punto 3.1: la carga correspondiente a un conjunto de viviendas se obtiene multiplicando la media aritm√©tica de las potencias m√°ximas previstas en cada vivienda por el coeficiente de simultaneidad indicado en la tabla 1, seg√∫n el n√∫mero de viviendas."
  },
  {
    pregunta: "Seg√∫n el REBT, para edificios con tarifa nocturna, la simultaneidad en viviendas ser√°:",
    opciones: [
      "Igual al n√∫mero de viviendas (coeficiente = n.¬∫ de viviendas)",
      "Constante e igual a 10",
      "La mitad del n√∫mero de viviendas",
      "La de la tabla 1 menos una vivienda"
    ],
    respuesta: "Igual al n√∫mero de viviendas (coeficiente = n.¬∫ de viviendas)",
    explicacion: "ITC-BT-10, punto 3.1, nota bajo la tabla 1: para edificios cuya instalaci√≥n est√© prevista para la aplicaci√≥n de la tarifa nocturna, la simultaneidad ser√° 1, es decir, coeficiente de simultaneidad igual al n√∫mero de viviendas."
  },
  {
    pregunta: "Seg√∫n el REBT, para n > 21 viviendas, el coeficiente de simultaneidad de la tabla 1 es:",
    opciones: [
      "15,3 + (n ‚àí 21) ¬∑ 0,5",
      "15,0 + (n ‚àí 21) ¬∑ 0,3",
      "10,6 + (n ‚àí 15) ¬∑ 0,7",
      "n / 2"
    ],
    respuesta: "15,3 + (n ‚àí 21) ¬∑ 0,5",
    explicacion: "ITC-BT-10, tabla 1 (Coeficiente de simultaneidad seg√∫n el n√∫mero de viviendas): para n > 21 viviendas, el coeficiente viene dado por la expresi√≥n 15,3 + (n ‚àí 21) ¬∑ 0,5."
  },
  {
    pregunta: "Seg√∫n el REBT, la carga de los servicios generales del edificio ser√°:",
    opciones: [
      "La suma de las potencias previstas (ascensores, centrales, alumbrado de comunes, etc.) con factor de simultaneidad 1",
      "La mitad de la suma de las potencias previstas",
      "La potencia del ascensor multiplicada por 1,8",
      "La potencia del alumbrado de escalera m√°s el 10 % del resto"
    ],
    respuesta: "La suma de las potencias previstas (ascensores, centrales, alumbrado de comunes, etc.) con factor de simultaneidad 1",
    explicacion: "ITC-BT-10, punto 3.2: la carga correspondiente a los servicios generales ser√° la suma de la potencia prevista en ascensores, aparatos elevadores, centrales de calor y fr√≠o, grupos de presi√≥n, alumbrado de portal, caja de escalera, espacios comunes y dem√°s servicios generales, sin aplicar ning√∫n factor de reducci√≥n por simultaneidad (factor de simultaneidad = 1)."
  },
  {
    pregunta: "Seg√∫n el REBT, en locales comerciales y oficinas integrados en el edificio de viviendas se considerar√°:",
    opciones: [
      "M√≠nimo 100 W/m¬≤ y planta, con m√≠nimo por local de 3450 W a 230 V y coeficiente 1",
      "M√≠nimo 50 W/m¬≤, sin m√≠nimo por local",
      "M√≠nimo 125 W/m¬≤ y planta, con m√≠nimo 10 350 W",
      "Solo la potencia de iluminaci√≥n instalada"
    ],
    respuesta: "M√≠nimo 100 W/m¬≤ y planta, con m√≠nimo por local de 3450 W a 230 V y coeficiente 1",
    explicacion: "ITC-BT-10, punto 3.3: la carga correspondiente a los locales comerciales y oficinas se calcula considerando un m√≠nimo de 100 W por metro cuadrado y planta, con un m√≠nimo por local de 3450 W a 230 V y coeficiente de simultaneidad 1."
  },
  {
    pregunta: "Seg√∫n el REBT, la carga de garajes integrados se calcular√° considerando:",
    opciones: [
      "10 W/m¬≤ y planta para ventilaci√≥n natural y 20 W/m¬≤ para ventilaci√≥n forzada, con m√≠nimo 3 450 W a 230 V y coeficiente 1",
      "5 W/m¬≤ y planta, sin m√≠nimos",
      "15 W/m¬≤ y planta, con m√≠nimo 9 200 W",
      "√önicamente 100 W/m¬≤, coeficiente 1"
    ],
    respuesta: "10 W/m¬≤ y planta para ventilaci√≥n natural y 20 W/m¬≤ para ventilaci√≥n forzada, con m√≠nimo 3 450 W a 230 V y coeficiente 1",
    explicacion: "ITC-BT-10, punto 3.4: la carga de los garajes se calcula con un m√≠nimo de 10 W por metro cuadrado y planta para garajes de ventilaci√≥n natural y de 20 W para los de ventilaci√≥n forzada, con un m√≠nimo de 3 450 W a 230 V y coeficiente de simultaneidad 1."
  },
  {
    pregunta: "Seg√∫n el REBT, en edificios comerciales u oficinas (no preferentemente viviendas) la carga a prever ser√°, como m√≠nimo:",
    opciones: [
      "100 W/m¬≤ y planta, con m√≠nimo por local de 3 450 W a 230 V y coeficiente 1",
      "50 W/m¬≤ sin m√≠nimos",
      "125 W/m¬≤ y planta con m√≠nimo 10 350 W",
      "3 680 W por local"
    ],
    respuesta: "100 W/m¬≤ y planta, con m√≠nimo por local de 3 450 W a 230 V y coeficiente 1",
    explicacion: "ITC-BT-10, punto 4.1: en edificios comerciales o de oficinas, la carga m√≠nima se calcula con 100 W por metro cuadrado y planta, con un m√≠nimo por local de 3 450 W a 230 V y coeficiente de simultaneidad 1."
  },
  {
    pregunta: "Seg√∫n el REBT, en edificios destinados a concentraci√≥n de industrias, la carga m√≠nima a prever ser√°:",
    opciones: [
      "125 W/m¬≤ y planta, con m√≠nimo por local de 10 350 W a 230 V y coeficiente 1",
      "100 W/m¬≤ con m√≠nimo 3 450 W",
      "75 W/m¬≤ sin m√≠nimos",
      "200 W/m¬≤ con coeficiente 0,8"
    ],
    respuesta: "125 W/m¬≤ y planta, con m√≠nimo por local de 10 350 W a 230 V y coeficiente 1",
    explicacion: "ITC-BT-10, punto 4.2: para edificios destinados a concentraci√≥n de industrias se considera un m√≠nimo de 125 W por metro cuadrado y planta, con un m√≠nimo por local de 10 350 W a 230 V y coeficiente de simultaneidad 1."
  },
  {
    pregunta: "Seg√∫n el REBT, en viviendas unifamiliares con infraestructura para recarga de VE se considerar√°:",
    opciones: [
      "Grado de electrificaci√≥n elevado",
      "Electrificaci√≥n b√°sica con 5 750 W",
      "Solo aumentar el coeficiente de simultaneidad",
      "Un m√≠nimo de 3 680 W adicional por vivienda sin m√°s"
    ],
    respuesta: "Grado de electrificaci√≥n elevado",
    explicacion: "ITC-BT-10, punto 5.1: para la previsi√≥n de cargas de viviendas unifamiliares dotadas de infraestructura para la recarga de veh√≠culos el√©ctricos se considerar√° grado de electrificaci√≥n elevado."
  },
  {
    pregunta: "Seg√∫n el REBT, en aparcamientos colectivos en propiedad horizontal la previsi√≥n de cargas para VE se calcula:",
    opciones: [
      "Multiplicando 3.680 W por el 10 % de las plazas construidas; la suma se multiplica por el factor de simultaneidad y se a√±ade al resto seg√∫n el esquema y la ITC-BT-52",
      "Sumando 3.680 W por cada plaza construida",
      "Tomando 10 % de la potencia total del edificio",
      "Aplicando 100 W/m¬≤ de la superficie de parking"
    ],
    respuesta: "Multiplicando 3.680 W por el 10 % de las plazas construidas; la suma se multiplica por el factor de simultaneidad y se a√±ade al resto seg√∫n el esquema y la ITC-BT-52",
    explicacion: "ITC-BT-10, punto 5.2: la previsi√≥n de cargas para la recarga de veh√≠culos el√©ctricos en aparcamientos colectivos se obtiene multiplicando 3 680 W por el 10 % del total de plazas de aparcamiento construidas; la suma de estas potencias se multiplica por el factor de simultaneidad correspondiente y se suma a la previsi√≥n de potencia del resto de la instalaci√≥n, seg√∫n el esquema y lo establecido en la ITC-BT-52."
  },
  {
    pregunta: "Seg√∫n el REBT, el proyectista podr√° prever una potencia instalada mayor para VE cuando:",
    opciones: [
      "Disponga de datos que lo justifiquen",
      "Lo exija la empresa instaladora",
      "Siempre, sin justificaci√≥n",
      "El promotor declare uso espor√°dico"
    ],
    respuesta: "Disponga de datos que lo justifiquen",
    explicacion: "ITC-BT-10, punto 5.2 (p√°rrafo final): se indica que el proyectista podr√° prever una potencia instalada mayor cuando disponga de los datos que lo justifiquen."
  },
  {
    pregunta: "Seg√∫n el REBT, las empresas distribuidoras estar√°n obligadas, si lo solicita el cliente, a efectuar el suministro monof√°sico que permita:",
    opciones: [
      "El funcionamiento de cualquier receptor ‚â§ 5 750 W a 230 V, hasta un suministro m√°ximo de 14 490 W a 230 V",
      "El funcionamiento hasta 9 200 W por circuito",
      "Solo receptores de hasta 3 450 W",
      "Cargas monof√°sicas de 16 A m√°ximo"
    ],
    respuesta: "El funcionamiento de cualquier receptor ‚â§ 5 750 W a 230 V, hasta un suministro m√°ximo de 14 490 W a 230 V",
    explicacion: "ITC-BT-10, punto 7 Suministros monof√°sicos: las empresas distribuidoras estar√°n obligadas, siempre que lo solicite el cliente, a efectuar el suministro de forma que permita el funcionamiento de cualquier receptor monof√°sico de potencia menor o igual a 5 750 W a 230 V, hasta un suministro de potencia m√°xima de 14 490 W a 230 V."
  },
  {
    pregunta: "Seg√∫n el REBT, en la previsi√≥n de potencia por local comercial dentro de edificio de viviendas, el coeficiente de simultaneidad aplicable es:",
    opciones: ["1", "0,9", "0,5", "El de la tabla 1 para viviendas"],
    respuesta: "1",
    explicacion: "ITC-BT-10, punto 3.3: para los locales comerciales y oficinas integrados en el edificio se indica un coeficiente de simultaneidad igual a 1."
  },
  {
    pregunta: "Seg√∫n el REBT, la carga de garajes con ventilaci√≥n forzada, a efectos de previsi√≥n, se toma con:",
    opciones: [
      "20 W/m¬≤ y planta, m√≠nimo 3 450 W a 230 V y coeficiente 1",
      "10 W/m¬≤ y planta, sin m√≠nimo",
      "100 W/m¬≤ y coeficiente 0,8",
      "125 W/m¬≤, m√≠nimo 10 350 W"
    ],
    respuesta: "20 W/m¬≤ y planta, m√≠nimo 3 450 W a 230 V y coeficiente 1",
    explicacion: "ITC-BT-10, punto 3.4: para garajes de ventilaci√≥n forzada se considera un m√≠nimo de 20 W por metro cuadrado y planta, con un m√≠nimo de 3 450 W a 230 V y coeficiente de simultaneidad 1."
  }
];












    /* ===== Estado ===== */
    let preguntasAleatorias = [];
    let indice = 0, aciertos = 0, errores = 0;
    let historial = [];
    let seleccionUsuario = null;
    let respondido = false;

    // Tiempo
    const DURACION_SEG = 60 * 60; // <<< 60 minutos
    let inicioTiempo = null;
    let intervaloTiempo = null;
    let tiempoAgotado = false;

    /* ===== Utilidades ===== */
    const mezclar = (arr) => { for (let i = arr.length-1; i>0; i--) { const j = Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]]; } return arr; };

    function mezclarPreguntas(){
      preguntasAleatorias = mezclar(preguntas.map(p=>({...p, opciones: mezclar([...p.opciones]) })));
      indice=0; aciertos=0; errores=0; historial=[];
    }

    const fmt2 = (n) => String(n).padStart(2,'0');
    const clamp0 = (x) => x < 0 ? 0 : x;

    function calcularPuntuacion(){
      const total = preguntasAleatorias.length;
      const penalizacion = Math.floor(errores / 2);
      const validasNetas = Math.max(0, aciertos - penalizacion);
      const puntos = validasNetas * 0.5;
      const porcentaje = clamp0((validasNetas / total) * 100);
      const apto = porcentaje >= 80;
      return { total, respondidas: aciertos+errores, enBlanco: total-(aciertos+errores), penalizacion, validasNetas, puntos, porcentaje, apto };
    }

    /* ===== Render ===== */
    function setProgreso(){
      const total = preguntasAleatorias.length;
      const pct = Math.round((indice/total)*100);
      const bar = document.getElementById('progress-bar');
      bar.style.width = pct + '%';
      bar.setAttribute('aria-valuenow', pct);
      document.getElementById('progress-txt').textContent = `${indice}/${total}`;
    }

    function actualizarContador(){
      if (!inicioTiempo) return;
      const transcurrido = Math.floor((Date.now()-inicioTiempo)/1000);
      const restantes = Math.max(0, DURACION_SEG - transcurrido);
      const mm = fmt2(Math.floor(restantes/60));
      const ss = fmt2(restantes%60);

      const { puntos } = calcularPuntuacion();
      const totalPuntos = preguntasAleatorias.length * 0.5;

      const relojClass =
        restantes <= 60 ? 'text-red-700' :
        restantes <= 5*60 ? 'text-orange-600' :
        'text-blue-700';

      document.getElementById("contador").innerHTML = `
        <span>Cuesti√≥n: ${indice + 1}/${preguntasAleatorias.length}</span>
        <span class="text-green-600">Aciertos: ${aciertos}</span>
        <span class="text-red-600">Fallos: ${errores}</span>
        <span>Puntos: ${puntos.toFixed(2)} / ${totalPuntos.toFixed(2)}</span>
        <span class="font-mono ${relojClass}">‚è≥ ${mm}:${ss}</span>`;

      if (restantes === 0 && !tiempoAgotado){
        tiempoAgotado = true;
        clearInterval(intervaloTiempo);
        deshabilitarInteraccion();
        abrirModalFin();
      }
    }

    function renderOpciones(opciones){
      const cont = document.getElementById("opciones");
      cont.innerHTML = "";
      opciones.forEach((op, i)=>{
        const btn = document.createElement("button");
        btn.type="button";
        btn.dataset.valor = op;
        btn.className="opcion w-full text-left bg-blue-600 hover:bg-blue-700 text-white px-5 py-3 rounded-xl shadow transition focus-visible:outline-none focus-visible:ring-4 focus-visible:ring-blue-300";
        btn.innerHTML = `<span class="font-semibold tracking-wide">${op}</span>`;
        btn.onclick = ()=>seleccionarOpcion(op);
        btn.setAttribute('aria-label',`Opci√≥n ${i+1}: ${op}`);
        cont.appendChild(btn);
      });
    }

    function cargarPregunta(){
      if (indice>=preguntasAleatorias.length) return mostrarResumen();
      const q = preguntasAleatorias[indice];
      seleccionUsuario=null; respondido=false;
      document.getElementById("pregunta").textContent = q.pregunta;
      renderOpciones(q.opciones);

      document.getElementById("acciones").innerHTML =
        `<div class="flex items-center justify-between mt-4 text-sm text-slate-500">
           <span>Elige una respuesta (teclas 1‚Äì4 y Enter).</span>
           <button disabled id="btn-contestar" class="opacity-50 cursor-not-allowed bg-slate-800 text-white px-4 py-2 rounded-lg">Contestar</button>
         </div>`;

      setProgreso();
      actualizarContador();
    }

    function seleccionarOpcion(opcion){
      if (respondido || tiempoAgotado) return;
      seleccionUsuario = opcion;
      document.querySelectorAll("#opciones .opcion").forEach(b=>{
        b.classList.remove('ring','ring-yellow-300','translate-y-0.5');
        if (b.dataset.valor===opcion) b.classList.add('ring','ring-yellow-300','translate-y-0.5');
      });
      const btn = document.getElementById('btn-contestar');
      btn.disabled=false;
      btn.classList.remove('opacity-50','cursor-not-allowed');
      btn.onclick=verificarRespuesta;
    }

    function verificarRespuesta(){
      if (respondido || !seleccionUsuario || tiempoAgotado) return;
      const actual = preguntasAleatorias[indice];
      const ok = seleccionUsuario===actual.respuesta;
      respondido = true;

      document.querySelectorAll("#opciones .opcion").forEach(b=>{
        b.disabled=true; b.classList.remove('ring','ring-yellow-300');
        const val=b.dataset.valor;
        if (val===actual.respuesta){
          b.classList.add('bg-green-600','hover:bg-green-700');
          b.innerHTML=`‚úÖ <span class="font-semibold">${val}</span>`;
        } else if (val===seleccionUsuario && !ok){
          b.classList.add('bg-red-600','hover:bg-red-700');
          b.innerHTML=`‚ùå <span class="font-semibold">${val}</span>`;
        } else {
          b.classList.add('bg-blue-500');
        }
      });

      ok ? aciertos++ : errores++;

      historial.push({
        pregunta:actual.pregunta,
        opciones:actual.opciones,
        correcta:actual.respuesta,
        elegida:seleccionUsuario,
        explicacion:actual.explicacion
      });

      /* === NUEVO: mostrar la explicaci√≥n debajo del bot√≥n === */
      document.getElementById("acciones").innerHTML =
        `<div class="mt-4 flex flex-col gap-3">

           <div class="flex items-center justify-end">
             <button onclick="siguientePregunta()" class="bg-blue-600 hover:bg-blue-700 text-white px-5 py-2 rounded-lg shadow">
               Siguiente
             </button>
           </div>

           <div id="explicacion" class="text-sm text-slate-700 bg-slate-100 border-l-4 border-blue-600 p-3 rounded-md">
             ${actual.explicacion || "Sin referencia disponible"}
           </div>

         </div>`;

      actualizarContador();
      setProgreso();
    }

    const siguientePregunta = ()=>{ if (!tiempoAgotado){ indice++; cargarPregunta(); } };

    function deshabilitarInteraccion(){
      document.querySelectorAll("#opciones .opcion").forEach(b=>{ b.disabled=true; });
      document.getElementById('btn-contestar')?.setAttribute('disabled','true');
      document.removeEventListener('keydown', handleKey);
    }

    function abrirModalFin(){
      const { total, respondidas, enBlanco, penalizacion, validasNetas, puntos, porcentaje, apto } = calcularPuntuacion();
      const modal = document.getElementById('modal-fin');
      const totalPuntos = total * 0.5;
      document.getElementById('modal-resumen').innerHTML = `
        <p class="text-slate-700">Respondidas: <strong>${respondidas}</strong> ‚Ä¢ En blanco: <strong>${enBlanco}</strong> ‚Ä¢ Total: ${total}</p>
        <p class="text-slate-700">Aciertos: <strong class="text-green-700">${aciertos}</strong> ‚Ä¢ Fallos: <strong class="text-red-700">${errores}</strong></p>
        <p class="text-slate-700">Penalizaci√≥n aplicada: <strong>-${penalizacion}</strong> v√°lidas</p>
        <p class="text-slate-700">V√°lidas netas: <strong>${validasNetas}</strong></p>
        <p class="text-slate-700">Puntuaci√≥n: <strong>${puntos.toFixed(2)} / ${totalPuntos.toFixed(2)}</strong> (<strong>${porcentaje.toFixed(2)}%</strong>)</p>
        <p class="${apto?'text-emerald-700':'text-red-700'} font-bold text-lg mt-1">${apto?'APTO ‚úÖ':'NO APTO ‚ùå'}</p>
      `;
      modal.classList.remove('hidden');
      modal.classList.add('flex');
    }

    function mostrarResumen(){
      clearInterval(intervaloTiempo);
      const total = preguntasAleatorias.length;
      const transcurrido = Math.floor((Date.now()-inicioTiempo)/1000);
      const mm = fmt2(Math.floor(transcurrido/60));
      const ss = fmt2(transcurrido%60);

      const { penalizacion, validasNetas, puntos, porcentaje, apto } = calcularPuntuacion();

      const detalle = historial.map(h=>`
        <div class='mb-2 border border-slate-200 rounded-lg p-3'>
          <p class='font-semibold mb-2'>${h.pregunta}</p>
          <div class='flex flex-wrap gap-2'>
            ${h.opciones.map(op=>{
              if (op===h.elegida && op===h.correcta)
                return `<span class='bg-green-100 text-green-900 px-2.5 py-1 rounded-md'>‚úÖ ${op}</span>`;
              if (op===h.elegida && op!==h.correcta)
                return `<span class='bg-red-100 text-red-900 px-2.5 py-1 rounded-md'>‚ùå ${op}</span>`;
              if (op===h.correcta && op!==h.elegida)
                return `<span class='bg-emerald-50 text-emerald-800 px-2.5 py-1 rounded-md'>‚úî ${op}</span>`;
              return `<span class='px-2.5 py-1 rounded-md bg-slate-50'>${op}</span>`;
            }).join('')}
          </div>
          <div class='mt-2 text-sm text-slate-600 bg-slate-100 border-l-4 border-blue-600 p-2 rounded-md'>
            üìò Explicaci√≥n: ${h.explicacion}
          </div>
        </div>
      `).join('');

      const totalPuntos = total * 0.5;

      document.getElementById("test").innerHTML = `
        <div class="space-y-3">
          <h2 class="text-2xl font-extrabold">Resultado del test 
            <span class="${apto?'text-emerald-700':'text-red-700'} text-xl align-middle">
              (${apto?'APTO ‚úÖ':'NO APTO ‚ùå'})
            </span>
          </h2>

          <p class="text-slate-700">
            Aciertos: <strong class="text-green-700">${aciertos}</strong> ‚Ä¢ 
            Fallos: <strong class="text-red-700">${errores}</strong> ‚Ä¢ 
            Penalizaci√≥n: <strong>-${penalizacion}</strong>
          </p>

          <p class="text-slate-700">
            V√°lidas netas: <strong>${validasNetas}</strong> / ${total} ‚Ä¢ 
            Puntuaci√≥n: <strong>${puntos.toFixed(2)} / ${totalPuntos.toFixed(2)}</strong> 
            (<strong>${porcentaje.toFixed(2)}%</strong>)
          </p>

          <p class="text-slate-700">Tiempo empleado: <span class="font-mono">${mm}:${ss}</span></p>

          <hr class="my-3 border-slate-200">

          <h3 class="text-lg font-bold">Detalle de preguntas</h3>

          <div class="max-h-[50vh] overflow-auto pr-1">
            ${detalle}
          </div>
        </div>

        <div class="flex flex-wrap items-center justify-center gap-3 mt-6">
          <button onclick="window.location.reload()" class="bg-emerald-600 hover:bg-emerald-700 text-white px-5 py-2 rounded-lg shadow">
            Volver a intentar
          </button>
          <a href="index.html" class="bg-slate-700 hover:bg-slate-800 text-white px-5 py-2 rounded-lg shadow">
            Volver al inicio
          </a>
        </div>`;
    }

    /* ===== Atajos de teclado ===== */
    function handleKey(e){
      if (tiempoAgotado) return;
      if (respondido){ if (e.key==='Enter') siguientePregunta(); return; }
      const map={'1':0,'2':1,'3':2,'4':3};
      if (map[e.key]!==undefined){
        const b=document.querySelectorAll('#opciones .opcion')[map[e.key]];
        if (b) b.click();
      }
      if (e.key==='Enter'){
        const b=document.getElementById('btn-contestar');
        if (b && !b.disabled) b.click();
      }
    }

    window.onload = ()=>{
      mezclarPreguntas();
      inicioTiempo = Date.now();
      cargarPregunta();
      intervaloTiempo = setInterval(actualizarContador, 1000);
      document.addEventListener('keydown', handleKey);
    };
  </script>

</head>

<body class="bg-gray-100 text-gray-900 p-4">
  <div class="max-w-3xl mx-auto bg-white p-6 md:p-8 rounded-2xl shadow-lg ring-1 ring-slate-100" id="test">
    <div class="mb-4">
      <div class="flex items-center justify-between text-sm text-slate-600 mb-2">
        <p id="contador" class="font-semibold space-x-4"></p>
        <span id="progress-txt" class="font-mono text-slate-500">0/0</span>
      </div>
      <div class="w-full bg-slate-200 rounded-full h-2.5 overflow-hidden">
        <div id="progress-bar" class="bg-blue-600 h-2.5 rounded-full transition-all duration-300 ease-out" style="width:0%" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"></div>
      </div>
    </div>

    <h1 class="text-3xl font-extrabold mb-3 text-center">ITC-BT-10</h1>
    <p id="pregunta" class="mb-4 text-lg text-center"></p>

    <div id="opciones" class="flex flex-col gap-3"></div>
    <div id="acciones" class="mt-2"></div>
  </div>

  <div class="mt-6 text-center">
    <a href="Test_por_ITC_del_REBT.html" class="inline-block bg-gray-700 hover:bg-gray-900 text-white px-6 py-2 rounded-lg shadow">Cancelar</a>
  </div>

  <!-- Modal Tiempo Agotado -->
  <div id="modal-fin" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/50 p-4">
    <div class="bg-white rounded-2xl shadow-xl max-w-lg w-full p-6">
      <h2 class="text-2xl font-extrabold mb-1">‚è∞ Tiempo agotado</h2>
      <p class="text-slate-600 mb-4">Tu tiempo se ha agotado. Estos son tus resultados:</p>
      <div id="modal-resumen" class="space-y-1 text-slate-800"></div>
      <div class="mt-6 flex justify-end">
        <button onclick="window.location.reload()" class="bg-emerald-600 hover:bg-emerald-700 text-white px-5 py-2 rounded-lg shadow">Volver a intentar</button>
      </div>
    </div>
  </div>

</body>
</html>
